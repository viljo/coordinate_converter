<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Coordinate Converter Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha512-sA+e2CpGNsq4CPGK/cPvX9nuSUXGMWzME2YkdE+5EYXPLk6l2b7xvFeoDyAJ6Digw1VE3D6Z0fjQX+0GoFfXWA=="
      crossorigin=""
    />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      body {
        position: relative;
        background: #f5f5f5;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
      }
      .crosshair {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 32px;
        height: 32px;
        margin-left: -16px;
        margin-top: -16px;
        pointer-events: none;
        border: 2px solid rgba(0, 123, 255, 0.8);
        border-radius: 50%;
      }
      .crosshair::before,
      .crosshair::after {
        content: "";
        position: absolute;
        background: rgba(0, 123, 255, 0.8);
      }
      .crosshair::before {
        top: 50%;
        left: -12px;
        right: -12px;
        height: 2px;
        margin-top: -1px;
      }
      .crosshair::after {
        left: 50%;
        top: -12px;
        bottom: -12px;
        width: 2px;
        margin-left: -1px;
      }
      #attribution {
        position: absolute;
        bottom: 8px;
        left: 8px;
        font-size: 11px;
        background: rgba(255, 255, 255, 0.8);
        padding: 4px 8px;
        border-radius: 4px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="crosshair"></div>
    <div id="attribution">
      &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors
    </div>
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha512-QV6so2G0QX+rPnSJN6D+PfYZ7RUTpujISiFDUFxu05oig3NbS1RyCBj8TDI7kGKuX3sX5Gucs5rtm6chQY1P4g=="
      crossorigin=""
    ></script>
    <script>
      const defaultLat = 59.3293;
      const defaultLon = 18.0686;
      const map = L.map("map", {
        center: [defaultLat, defaultLon],
        zoom: 10,
        attributionControl: false,
      });

      function getTileUrl() {
        const params = new URLSearchParams(window.location.search);
        const tile = params.get("tile");
        if (tile) {
          return decodeURIComponent(tile);
        }
        if (window && window.fletTileUrl) {
          return window.fletTileUrl;
        }
        return "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
      }

      const tileLayer = L.tileLayer(getTileUrl(), {
        maxZoom: 19,
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
      });
      tileLayer.addTo(map);
      tileLayer.on("load", () => map.invalidateSize());

      map.whenReady(() => {
        setTimeout(() => map.invalidateSize(), 150);
      });

      if (window.ResizeObserver) {
        const resizeObserver = new ResizeObserver(() => map.invalidateSize());
        resizeObserver.observe(document.body);
      } else {
        window.addEventListener("resize", () => map.invalidateSize());
      }

      window.updateMapCenter = function updateMapCenter(lat, lon) {
        if (!isFinite(lat) || !isFinite(lon)) {
          return;
        }
        map.setView([lat, lon], map.getZoom(), { animate: false });
      };
    </script>
  </body>
</html>
